<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Casino</title>
    <style>
        :root {
            --primary: #00cc66;
            --secondary: #1a1a1a;
            --accent: #00ff00;
            --text: #ffffff;
            --border: #333333;
            --bg: #000000;
            --danger: #cc0000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .header {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            background: var(--secondary);
        }

        .header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .balance-display {
            font-size: 18px;
            color: var(--primary);
            margin-top: 5px;
        }

        .main-content {
            flex: 1;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .section {
            background: var(--secondary);
            border-radius: 10px;
            padding: 15px;
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –°–ª–æ—Ç—ã */
        .slots-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            margin: 20px 0;
            gap: 10px;
        }

        .slot {
            width: 80px;
            height: 80px;
            background: #222;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 2px solid var(--border);
            overflow: hidden;
            position: relative;
        }

        .slot-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .slot-spinning .slot-image {
            animation: spinSlot 0.5s infinite linear;
        }

        @keyframes spinSlot {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        /* –ö—Ä–∞—à */
        .crash-container {
            text-align: center;
            padding: 20px;
        }

        .crash-graph {
            height: 150px;
            background: #222;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .crash-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent);
        }

        .crash-multiplier {
            font-size: 48px;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 18px;
            font-weight: bold;
        }

        .profile-rating {
            color: var(--primary);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: #222;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin: 5px 0;
        }

        .stat-label {
            font-size: 14px;
            color: #aaa;
        }

        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .nft-card {
            background: #222;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .nft-card:hover {
            transform: scale(1.05);
        }

        .nft-image {
            width: 100%;
            height: 100px;
            background: #333;
            border-radius: 5px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #aaa;
        }

        .nft-name {
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
        }

        .nft-collection {
            font-size: 10px;
            color: #aaa;
        }

        .bet-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .bet-button:hover {
            background: #00aa55;
        }

        .bet-button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .free-mode-btn {
            background: #555;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }

        .free-mode-btn:hover {
            background: #777;
        }

        .footer {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: var(--secondary);
            border-top: 1px solid var(--border);
        }

        .footer-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            width: 33%;
            color: #aaa;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .footer-btn.active {
            color: var(--primary);
        }

        .footer-btn i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #222;
            text-align: center;
        }

        .message.success {
            background: var(--primary);
            color: white;
        }

        .message.error {
            background: var(--danger);
            color: white;
        }

        .hidden {
            display: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–ª–æ—Ç–æ–≤ */
        @keyframes slotSpin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>NFT Casino</h2>
        <p class="balance-display">–ë–∞–ª–∞–Ω—Å: <span id="balanceValue">0</span> –∑–≤—ë–∑–¥</p>
    </div>

    <div class="main-content">
        <!-- –°–ª–æ—Ç—ã -->
        <div class="section" id="slotsSection">
            <h3>–°–ª–æ—Ç—ã</h3>
            <div class="slots-container">
                <div class="slot" id="slot1"><img class="slot-image" src="https://via.placeholder.com/80?text=NFT1" alt="NFT"></div>
                <div class="slot" id="slot2"><img class="slot-image" src="https://via.placeholder.com/80?text=NFT2" alt="NFT"></div>
                <div class="slot" id="slot3"><img class="slot-image" src="https://via.placeholder.com/80?text=NFT3" alt="NFT"></div>
            </div>
            <button class="bet-button" id="spinButton">–ö—Ä—É—Ç–∏—Ç—å (400 –∑–≤—ë–∑–¥)</button>
            <button class="free-mode-btn" id="freeSpinButton">Free Spin</button>
        </div>

        <!-- –ö—Ä–∞—à -->
        <div class="section" id="crashSection">
            <h3>–ö—Ä–∞—à</h3>
            <div class="crash-container">
                <div class="crash-graph">
                    <div class="crash-line" id="crashLine"></div>
                </div>
                <div class="crash-multiplier" id="crashMultiplier">1.00x</div>
                <button class="bet-button" id="crashBetButton">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
                <button class="bet-button hidden" id="crashCashoutButton">–í—ã–≤–µ—Å—Ç–∏</button>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div class="section" id="profileSection">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <div class="profile-info">
                    <div class="profile-name" id="profileName">Loading...</div>
                    <div class="profile-rating" id="profileRating">–†–µ–π—Ç–∏–Ω–≥: 0</div>
                </div>
            </div>
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalBets">0</div>
                    <div class="stat-label">–°—Ç–∞–≤–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalWithdraws">0</div>
                    <div class="stat-label">–í—ã–≤–æ–¥–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalNFTs">0</div>
                    <div class="stat-label">NFT</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
            </div>
            <h4>–ú–æ–∏ NFT</h4>
            <div class="nft-grid" id="nftGrid">
                <!-- NFT –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="messageContainer"></div>
    </div>

    <div class="footer">
        <a href="#" class="footer-btn active" id="tabSlots">
            <span>üé∞</span>
            <span>–°–ª–æ—Ç—ã</span>
        </a>
        <a href="#" class="footer-btn" id="tabCrash">
            <span>üöÄ</span>
            <span>–ö—Ä–∞—à</span>
        </a>
        <a href="#" class="footer-btn" id="tabProfile">
            <span>üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const balanceValue = document.getElementById('balanceValue');
        const slotsSection = document.getElementById('slotsSection');
        const crashSection = document.getElementById('crashSection');
        const profileSection = document.getElementById('profileSection');
        const tabSlots = document.getElementById('tabSlots');
        const tabCrash = document.getElementById('tabCrash');
        const tabProfile = document.getElementById('tabProfile');
        const spinButton = document.getElementById('spinButton');
        const freeSpinButton = document.getElementById('freeSpinButton');
        const slot1 = document.getElementById('slot1');
        const slot2 = document.getElementById('slot2');
        const slot3 = document.getElementById('slot3');
        const crashBetButton = document.getElementById('crashBetButton');
        const crashCashoutButton = document.getElementById('crashCashoutButton');
        const crashMultiplier = document.getElementById('crashMultiplier');
        const crashLine = document.getElementById('crashLine');
        const profileName = document.getElementById('profileName');
        const profileRating = document.getElementById('profileRating');
        const profileAvatar = document.getElementById('profileAvatar');
        const totalBets = document.getElementById('totalBets');
        const totalWithdraws = document.getElementById('totalWithdraws');
        const totalNFTs = document.getElementById('totalNFTs');
        const winRate = document.getElementById('winRate');
        const nftGrid = document.getElementById('nftGrid');
        const messageContainer = document.getElementById('messageContainer');

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let userData = {};
        let userBalance = 0;
        let userNFTs = [];
        let userStats = { total_bets: 0, total_withdraws: 0, total_nfts: 0, win_rate: 0 };
        let isCrashGameActive = false;
        let crashInterval = null;
        let crashMultiplierValue = 1.00;

        // –ò–∫–æ–Ω–∫–∏ NFT (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - URL –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
        const nftIcons = [
            'https://via.placeholder.com/80?text=NFT1',
            'https://via.placeholder.com/80?text=NFT2',
            'https://via.placeholder.com/80?text=NFT3',
            'https://via.placeholder.com/80?text=NFT4',
            'https://via.placeholder.com/80?text=NFT5'
        ];

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessage(text, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = text;
            messageContainer.appendChild(messageEl);
            setTimeout(() => messageEl.remove(), 3000); // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function showSection(sectionId) {
            slotsSection.classList.remove('active');
            crashSection.classList.remove('active');
            profileSection.classList.remove('active');
            if (sectionId === 'slots') slotsSection.classList.add('active');
            if (sectionId === 'crash') crashSection.classList.add('active');
            if (sectionId === 'profile') profileSection.classList.add('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –≤ footer
            tabSlots.classList.remove('active');
            tabCrash.classList.remove('active');
            tabProfile.classList.remove('active');
            if (sectionId === 'slots') tabSlots.classList.add('active');
            if (sectionId === 'crash') tabCrash.classList.add('active');
            if (sectionId === 'profile') tabProfile.classList.add('active');
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –±–æ—Ç–∞
        async function fetchUserData() {
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–æ—Ç—É
                // –ù–∞–ø—Ä–∏–º–µ—Ä: fetch('/api/user?user_id=' + tg.initDataUnsafe.user.id)
                // –ü–æ–∫–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                userData = {
                    id: tg.initDataUnsafe.user.id,
                    username: tg.initDataUnsafe.user.username || 'User',
                    first_name: tg.initDataUnsafe.user.first_name || 'User',
                    last_name: tg.initDataUnsafe.user.last_name || '',
                    avatar_url: 'https://via.placeholder.com/60?text=üë§',
                    balance: 0,
                    nfts: [],
                    stats: {
                        total_bets: 0,
                        total_withdraws: 0,
                        total_nfts: 0,
                        win_rate: 0
                    }
                };

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateUI();
            } catch (e) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
        function updateUI() {
            userBalance = userData.balance;
            userNFTs = userData.nfts;
            userStats = userData.stats;

            balanceValue.textContent = userBalance;
            profileName.textContent = userData.first_name + ' ' + userData.last_name;
            profileAvatar.style.backgroundImage = `url(${userData.avatar_url})`;
            profileRating.textContent = `–†–µ–π—Ç–∏–Ω–≥: ${userStats.win_rate}%`;
            totalBets.textContent = userStats.total_bets;
            totalWithdraws.textContent = userStats.total_withdraws;
            totalNFTs.textContent = userStats.total_nfts;
            winRate.textContent = `${userStats.win_rate}%`;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ç–∫—É NFT
            nftGrid.innerHTML = '';
            if (userNFTs.length === 0) {
                const noNFT = document.createElement('div');
                noNFT.className = 'nft-card';
                noNFT.innerHTML = '<div class="nft-image">No NFT</div><div class="nft-name">–ü—É—Å—Ç–æ</div>';
                nftGrid.appendChild(noNFT);
            } else {
                userNFTs.forEach(nft => {
                    const card = document.createElement('div');
                    card.className = 'nft-card';
                    card.innerHTML = `
                        <div class="nft-image"><img src="${nft.image}" alt="${nft.name}" style="width:100%;height:100%;object-fit:cover;"></div>
                        <div class="nft-name">${nft.name}</div>
                        <div class="nft-collection">${nft.collection}</div>
                    `;
                    nftGrid.appendChild(card);
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å–ª–æ—Ç–æ–≤
        async function startSlots(freeMode = false) {
            if (!freeMode && userBalance < 400) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!', 'error');
                return;
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            slot1.classList.add('slot-spinning');
            slot2.classList.add('slot-spinning');
            slot3.classList.add('slot-spinning');

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                slot1.classList.remove('slot-spinning');
                slot2.classList.remove('slot-spinning');
                slot3.classList.remove('slot-spinning');

                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ NFT
                const randomNFT1 = nftIcons[Math.floor(Math.random() * nftIcons.length)];
                const randomNFT2 = nftIcons[Math.floor(Math.random() * nftIcons.length)];
                const randomNFT3 = nftIcons[Math.floor(Math.random() * nftIcons.length)];

                slot1.querySelector('.slot-image').src = randomNFT1;
                slot2.querySelector('.slot-image').src = randomNFT2;
                slot3.querySelector('.slot-image').src = randomNFT3;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ - –≤—ã–∏–≥—Ä—ã—à)
                if (randomNFT1 === randomNFT2 && randomNFT2 === randomNFT3) {
                    showMessage('üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!', 'success');
                    if (!freeMode) {
                        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è NFT
                        // tg.sendData('win_nft');
                        // –ò –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                        userData.balance += 100; // –ü—Ä–∏–º–µ—Ä
                        userStats.total_bets++;
                        userStats.total_nfts++;
                        userStats.win_rate = Math.round((userStats.total_nfts / userStats.total_bets) * 100);
                        userData.nfts.push({
                            name: 'New NFT',
                            collection: 'Random Collection',
                            image: randomNFT1
                        });
                        updateUI();
                    }
                } else {
                    showMessage('‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à', 'error');
                    if (!freeMode) {
                        userData.balance -= 400;
                        userStats.total_bets++;
                        userStats.win_rate = Math.round((userStats.total_nfts / userStats.total_bets) * 100);
                        updateUI();
                    }
                }
            }, 2000);
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ö—Ä–∞—à–∞
        function startCrash() {
            if (isCrashGameActive) return;

            isCrashGameActive = true;
            crashMultiplierValue = 1.00;
            crashMultiplier.textContent = `${crashMultiplierValue.toFixed(2)}x`;
            crashLine.style.width = '0%';

            crashInterval = setInterval(() => {
                crashMultiplierValue += 0.01;
                crashMultiplier.textContent = `${crashMultiplierValue.toFixed(2)}x`;
                crashLine.style.width = `${Math.min(crashMultiplierValue * 10, 100)}%`;

                // –°–ª—É—á–∞–π–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º –∏–≥—Ä—É
                if (Math.random() < 0.01) {
                    endCrash();
                }
            }, 100);
        }

        function endCrash() {
            clearInterval(crashInterval);
            isCrashGameActive = false;
            crashCashoutButton.classList.add('hidden');
            crashBetButton.classList.remove('hidden');
            showMessage(`üí• –ö—Ä–∞—à! –ú–Ω–æ–∂–∏—Ç–µ–ª—å: ${crashMultiplierValue.toFixed(2)}x`, 'error');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        tabSlots.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('slots');
        });

        tabCrash.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('crash');
        });

        tabProfile.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('profile');
        });

        spinButton.addEventListener('click', () => {
            startSlots(false);
        });

        freeSpinButton.addEventListener('click', () => {
            startSlots(true);
        });

        crashBetButton.addEventListener('click', () => {
            startCrash();
            crashBetButton.classList.add('hidden');
            crashCashoutButton.classList.remove('hidden');
        });

        crashCashoutButton.addEventListener('click', () => {
            if (isCrashGameActive) {
                endCrash();
                showMessage(`‚úÖ –í—ã –≤—ã–≤–µ–ª–∏ ${crashMultiplierValue.toFixed(2)}x`, 'success');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        fetchUserData();

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - –ø–æ —Å–æ–±—ã—Ç–∏—è–º)
        setInterval(fetchUserData, 5000);

    </script>
</body>
</html>
